# SETDIG uses Kong API Gateway for backend APIs
# This IngressRoute will be configured by SETDIG team during deployment
# Following the naming convention from the manual

apiVersion: traefik.containo.us/v1alpha1
kind: IngressRoute
metadata:
  name: k0420-prd-ms-inova-mais-back-ingress
  namespace: default
  annotations:
    konghq.com/plugins: "K0420-jwt-auth"
spec:
  entryPoints:
    - web
    - websecure
  routes:
  - match: Host(`msinovamais.ms.gov.br`) && PathPrefix(`/api`)
    kind: Rule
    services:
    - name: k0420-prd-ms-inova-mais-back
      port: 3001
    middlewares:
    - name: strip-prefix-backend
  
  # Public documentation endpoint (no JWT required)
  - match: Host(`msinovamais.ms.gov.br`) && PathPrefix(`/api/swagger`)
    kind: Rule
    services:
    - name: k0420-prd-ms-inova-mais-back
      port: 3001
  
  tls:
    certResolver: default

---
# Middleware to strip the prefix
apiVersion: traefik.containo.us/v1alpha1
kind: Middleware
metadata:
  name: strip-prefix-backend
  namespace: default
spec:
  stripPrefix:
    prefixes:
      - /api
